{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/phil/Dev/philplaysbass/app/api/spotify/token/route.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\n\nexport default async function handler(\n\treq: NextApiRequest,\n\tres: NextApiResponse\n) {\n\tconst { code } = req.body;\n\n\tif (!code) {\n\t\treturn res.status(400).json({ error: \"Authorization code is missing\" });\n\t}\n\n\tconst params = new URLSearchParams({\n\t\tgrant_type: \"authorization_code\",\n\t\tcode,\n\t\tredirect_uri: process.env.SPOTIFY_REDIRECT_URI!,\n\t\tclient_id: process.env.SPOTIFY_CLIENT_ID!,\n\t\tclient_secret: process.env.SPOTIFY_CLIENT_SECRET!,\n\t});\n\n\ttry {\n\t\tconst response = await fetch(\"https://accounts.spotify.com/api/token\", {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\",\n\t\t\t},\n\t\t\tbody: params.toString(),\n\t\t});\n\n\t\tconst data = await response.json();\n\n\t\tif (!response.ok) {\n\t\t\treturn res\n\t\t\t\t.status(response.status)\n\t\t\t\t.json({ error: data.error_description });\n\t\t}\n\n\t\t// Optional: store refresh_token in a cookie or DB\n\t\treturn res.status(200).json(data); // access_token, refresh_token, expires_in\n\t} catch (err) {\n\t\tconsole.error(\"[Spotify Token Error]\", err);\n\t\treturn res.status(500).json({ error: \"Internal Server Error\" });\n\t}\n}\n// app/api/spotify/token/route.ts\n\nexport async function POST(req: Request) {\n\ttry {\n\t\tconst body = await req.json();\n\t\tconst code = body.code;\n\n\t\tif (!code) {\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({ error: \"Missing authorization code\" }),\n\t\t\t\t{\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tconst client_id = process.env.NEXT_PUBLIC_SPOTIFY_CLIENT_ID!;\n\t\tconst client_secret = process.env.SPOTIFY_CLIENT_SECRET!;\n\t\tconst redirect_uri = process.env.NEXT_PUBLIC_SPOTIFY_REDIRECT_URI!;\n\n\t\tconst credentials = Buffer.from(`${client_id}:${client_secret}`).toString(\n\t\t\t\"base64\"\n\t\t);\n\n\t\tconst tokenRes = await fetch(\"https://accounts.spotify.com/api/token\", {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Basic ${credentials}`,\n\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded\",\n\t\t\t},\n\t\t\tbody: new URLSearchParams({\n\t\t\t\tgrant_type: \"authorization_code\",\n\t\t\t\tcode,\n\t\t\t\tredirect_uri,\n\t\t\t}),\n\t\t});\n\n\t\tif (!tokenRes.ok) {\n\t\t\tconst errorText = await tokenRes.text();\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({\n\t\t\t\t\terror: \"Failed to exchange token\",\n\t\t\t\t\tdetails: errorText,\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tstatus: tokenRes.status,\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tconst tokenData = await tokenRes.json();\n\n\t\treturn new Response(\n\t\t\tJSON.stringify({\n\t\t\t\taccess_token: tokenData.access_token,\n\t\t\t\trefresh_token: tokenData.refresh_token,\n\t\t\t\texpires_in: tokenData.expires_in,\n\t\t\t\tscope: tokenData.scope,\n\t\t\t\ttoken_type: tokenData.token_type,\n\t\t\t}),\n\t\t\t{\n\t\t\t\tstatus: 200,\n\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t}\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(\"Error in /api/spotify/token:\", error);\n\t\treturn new Response(JSON.stringify({ error: \"Internal server error\" }), {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t});\n\t}\n}\n"],"names":[],"mappings":";;;;AAEe,eAAe,QAC7B,GAAmB,EACnB,GAAoB;IAEpB,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,IAAI;IAEzB,IAAI,CAAC,MAAM;QACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAgC;IACtE;IAEA,MAAM,SAAS,IAAI,gBAAgB;QAClC,YAAY;QACZ;QACA,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAC9C,WAAW,QAAQ,GAAG,CAAC,iBAAiB;QACxC,eAAe,QAAQ,GAAG,CAAC,qBAAqB;IACjD;IAEA,IAAI;QACH,MAAM,WAAW,MAAM,MAAM,0CAA0C;YACtE,QAAQ;YACR,SAAS;gBACR,gBAAgB;YACjB;YACA,MAAM,OAAO,QAAQ;QACtB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YACjB,OAAO,IACL,MAAM,CAAC,SAAS,MAAM,EACtB,IAAI,CAAC;gBAAE,OAAO,KAAK,iBAAiB;YAAC;QACxC;QAEA,kDAAkD;QAClD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC,OAAO,0CAA0C;IAC9E,EAAE,OAAO,KAAK;QACb,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAwB;IAC9D;AACD;AAGO,eAAe,KAAK,GAAY;IACtC,IAAI;QACH,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,OAAO,KAAK,IAAI;QAEtB,IAAI,CAAC,MAAM;YACV,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA6B,IACrD;gBACC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAC/C;QAEF;QAEA,MAAM;QACN,MAAM,gBAAgB,QAAQ,GAAG,CAAC,qBAAqB;QACvD,MAAM;QAEN,MAAM,cAAc,OAAO,IAAI,CAAC,GAAG,UAAU,CAAC,EAAE,eAAe,EAAE,QAAQ,CACxE;QAGD,MAAM,WAAW,MAAM,MAAM,0CAA0C;YACtE,QAAQ;YACR,SAAS;gBACR,eAAe,CAAC,MAAM,EAAE,aAAa;gBACrC,gBAAgB;YACjB;YACA,MAAM,IAAI,gBAAgB;gBACzB,YAAY;gBACZ;gBACA;YACD;QACD;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACjB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;gBACd,OAAO;gBACP,SAAS;YACV,IACA;gBACC,QAAQ,SAAS,MAAM;gBACvB,SAAS;oBAAE,gBAAgB;gBAAmB;YAC/C;QAEF;QAEA,MAAM,YAAY,MAAM,SAAS,IAAI;QAErC,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;YACd,cAAc,UAAU,YAAY;YACpC,eAAe,UAAU,aAAa;YACtC,YAAY,UAAU,UAAU;YAChC,OAAO,UAAU,KAAK;YACtB,YAAY,UAAU,UAAU;QACjC,IACA;YACC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IAEF,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAwB,IAAI;YACvE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IACD;AACD","debugId":null}}]
}