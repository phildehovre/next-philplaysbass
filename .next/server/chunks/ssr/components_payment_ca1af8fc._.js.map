{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/phil/Dev/philplaysbass/components/payment/StripePayment.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport {\n\tuseStripe,\n\tuseElements,\n\tPaymentElement,\n} from \"@stripe/react-stripe-js\";\n\nconst StripePayment = ({ handleSubmitRegistration }) => {\n\tconst stripe = useStripe();\n\tconst elements = useElements();\n\n\tconst [errorMessage, setErrorMessage] = useState(null);\n\n\tconst handleSubmit = async (event) => {\n\t\tevent.preventDefault();\n\n\t\tif (elements == null) {\n\t\t\treturn;\n\t\t}\n\t\thandleSubmitRegistration();\n\n\t\t// Trigger form validation and wallet collection\n\t\tconst { error: submitError } = await elements.submit();\n\t\tif (submitError) {\n\t\t\t// Show error to your customer\n\t\t\tsetErrorMessage(submitError.message);\n\t\t\treturn;\n\t\t}\n\n\t\t// Create the PaymentIntent and obtain clientSecret from your server endpoint\n\t\tconst res = await fetch(\n\t\t\t`${import.meta.env.VITE_API_URL}/checkout/create-payment-intent`,\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t}\n\t\t);\n\t\tconst { client_secret: clientSecret } = await res.json();\n\n\t\tconst { error } = await stripe.confirmPayment({\n\t\t\t//`Elements` instance that was used to create the Payment Element\n\t\t\telements,\n\t\t\tclientSecret,\n\t\t\tconfirmParams: {\n\t\t\t\treturn_url: `${import.meta.env.VITE_CLIENT_URL}/checkout/success`,\n\t\t\t},\n\t\t});\n\n\t\tif (error) {\n\t\t\t// This point will only be reached if there is an immediate error when\n\t\t\t// confirming the payment. Show error to your customer (for example, payment\n\t\t\t// details incomplete)\n\t\t\tsetErrorMessage(error.message);\n\t\t} else {\n\t\t\t// Your customer will be redirected to your `return_url`. For some payment\n\t\t\t// methods like iDEAL, your customer will be redirected to an intermediate\n\t\t\t// site first to authorize the payment, then redirected to the `return_url`.\n\t\t}\n\t};\n\n\treturn (\n\t\t<form onSubmit={handleSubmit}>\n\t\t\t<PaymentElement />\n\t\t\t<button type=\"submit\" disabled={!stripe || !elements}>\n\t\t\t\tPay\n\t\t\t</button>\n\t\t\t{/* Show error message to your customers */}\n\t\t\t{errorMessage && <div>{errorMessage}</div>}\n\t\t</form>\n\t);\n};\n\nexport default StripePayment;\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;;;AAMA,MAAM,gBAAgB,CAAC,EAAE,wBAAwB,EAAE;IAClD,MAAM,SAAS,CAAA,GAAA,oLAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,oLAAA,CAAA,cAAW,AAAD;IAE3B,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEjD,MAAM,eAAe,OAAO;QAC3B,MAAM,cAAc;QAEpB,IAAI,YAAY,MAAM;YACrB;QACD;QACA;QAEA,gDAAgD;QAChD,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAAS,MAAM;QACpD,IAAI,aAAa;YAChB,8BAA8B;YAC9B,gBAAgB,YAAY,OAAO;YACnC;QACD;QAEA,6EAA6E;QAC7E,MAAM,MAAM,MAAM,MACjB,GAAG,8BAAY,GAAG,CAAC,YAAY,CAAC,+BAA+B,CAAC,EAChE;YACC,QAAQ;QACT;QAED,MAAM,EAAE,eAAe,YAAY,EAAE,GAAG,MAAM,IAAI,IAAI;QAEtD,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,cAAc,CAAC;YAC7C,iEAAiE;YACjE;YACA;YACA,eAAe;gBACd,YAAY,GAAG,8BAAY,GAAG,CAAC,eAAe,CAAC,iBAAiB,CAAC;YAClE;QACD;QAEA,IAAI,OAAO;YACV,sEAAsE;YACtE,4EAA4E;YAC5E,sBAAsB;YACtB,gBAAgB,MAAM,OAAO;QAC9B,OAAO;QACN,0EAA0E;QAC1E,0EAA0E;QAC1E,4EAA4E;QAC7E;IACD;IAEA,qBACC,8OAAC;QAAK,UAAU;;0BACf,8OAAC,oLAAA,CAAA,iBAAc;;;;;0BACf,8OAAC;gBAAO,MAAK;gBAAS,UAAU,CAAC,UAAU,CAAC;0BAAU;;;;;;YAIrD,8BAAgB,8OAAC;0BAAK;;;;;;;;;;;;AAG1B;uCAEe","debugId":null}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/phil/Dev/philplaysbass/components/payment/PaymentForm.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport \"./Form.css\";\nimport StripePayment from \"./StripePayment\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { Elements } from \"@stripe/react-stripe-js\";\n\nconst stripePromise = loadStripe(process.env.VITE_STRIPE_PK as string);\n\ntype PaymentFormProps = {\n\tonSubmit: () => void;\n\tpaymentDetails: FormData;\n};\n\ntype FormData = {\n\tiban: string;\n\taccount_holder: string;\n};\n\nconst PaymentForm: React.FC<PaymentFormProps> = ({\n\tonSubmit,\n\tpaymentDetails,\n}) => {\n\tconst [clientSecret, setClientSecret] = useState();\n\tconst {\n\t\thandleSubmit,\n\t\tregister,\n\t\tsetValue,\n\t\tformState: { errors },\n\t} = useForm<FormData>({ defaultValues: paymentDetails });\n\n\tconst options = {\n\t\tclientSecret,\n\t};\n\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\n\t\t\t\t\t`${process.env.VITE_API_URL}/checkout/create-payment-intent`,\n\t\t\t\t\t{\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t// body: JSON.stringify({amount: parseFloat(paymentPeriod.price) * 100, currency: \"usd\"}),\n\t\t\t\t\t\tbody: JSON.stringify({ amount: 50, currency: \"usd\" }),\n\t\t\t\t\t\tcredentials: \"include\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst secret = await res.json();\n\t\t\t\tsetClientSecret(secret.clientSecret);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"Payment intent error:\", err);\n\t\t\t\tthrow new Error(\"Failed to create payment intent\");\n\t\t\t}\n\t\t})();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (paymentDetails) {\n\t\t\tsetValue(\"account_holder\", paymentDetails.account_holder);\n\t\t\tsetValue(\"iban\", paymentDetails.iban);\n\t\t}\n\t}, [setValue, paymentDetails]);\n\n\treturn (\n\t\t<div className=\"\">\n\t\t\t<form className=\"form_ctn\" onSubmit={handleSubmit(onSubmit)}>\n\t\t\t\t<h2>IBAN</h2>\n\t\t\t\t<div className=\"input-row\">\n\t\t\t\t\t<div className=\"control\">\n\t\t\t\t\t\t<label htmlFor=\"account_holder\">\n\t\t\t\t\t\t\tAccount holder\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t{...register(\"account_holder\", {\n\t\t\t\t\t\t\t\t\trequired: \"Account holder name is required\",\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\tclassName={errors.account_holder ? \"error\" : \"\"}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t{errors.account_holder && (\n\t\t\t\t\t\t\t<p className=\"error\">{errors.account_holder.message}</p>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"control\">\n\t\t\t\t\t\t<label htmlFor=\"iban\">\n\t\t\t\t\t\t\tAccount IBAN\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t{...register(\"iban\", { required: \"IBAN is required\" })}\n\t\t\t\t\t\t\t\tclassName={errors.iban ? \"error\" : \"\"}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t{errors.iban && <p className=\"error\">{errors.iban.message}</p>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<h2>Your first payment</h2>\n\t\t\t</form>\n\t\t\t{clientSecret && (\n\t\t\t\t<Elements stripe={stripePromise} options={options}>\n\t\t\t\t\t<StripePayment handleSubmitRegistration={onSubmit} />\n\t\t\t\t</Elements>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default PaymentForm;\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AANA;;;;;;;;AAQA,MAAM,gBAAgB,CAAA,GAAA,0JAAA,CAAA,aAAU,AAAD,EAAE,QAAQ,GAAG,CAAC,cAAc;AAY3D,MAAM,cAA0C,CAAC,EAChD,QAAQ,EACR,cAAc,EACd;IACA,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD;IAC/C,MAAM,EACL,YAAY,EACZ,QAAQ,EACR,QAAQ,EACR,WAAW,EAAE,MAAM,EAAE,EACrB,GAAG,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAY;QAAE,eAAe;IAAe;IAEtD,MAAM,UAAU;QACf;IACD;IAEA,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACT,CAAC;YACA,IAAI;gBACH,MAAM,MAAM,MAAM,MACjB,GAAG,QAAQ,GAAG,CAAC,YAAY,CAAC,+BAA+B,CAAC,EAC5D;oBACC,QAAQ;oBACR,0FAA0F;oBAC1F,MAAM,KAAK,SAAS,CAAC;wBAAE,QAAQ;wBAAI,UAAU;oBAAM;oBACnD,aAAa;oBACb,SAAS;wBACR,gBAAgB;oBACjB;gBACD;gBAED,MAAM,SAAS,MAAM,IAAI,IAAI;gBAC7B,gBAAgB,OAAO,YAAY;YACpC,EAAE,OAAO,KAAK;gBACb,QAAQ,KAAK,CAAC,yBAAyB;gBACvC,MAAM,IAAI,MAAM;YACjB;QACD,CAAC;IACF,GAAG,EAAE;IAEL,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACT,IAAI,gBAAgB;YACnB,SAAS,kBAAkB,eAAe,cAAc;YACxD,SAAS,QAAQ,eAAe,IAAI;QACrC;IACD,GAAG;QAAC;QAAU;KAAe;IAE7B,qBACC,8OAAC;QAAI,WAAU;;0BACd,8OAAC;gBAAK,WAAU;gBAAW,UAAU,aAAa;;kCACjD,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;wBAAI,WAAU;;0CACd,8OAAC;gCAAI,WAAU;;kDACd,8OAAC;wCAAM,SAAQ;;4CAAiB;0DAE/B,8OAAC;gDACA,MAAK;gDACJ,GAAG,SAAS,kBAAkB;oDAC9B,UAAU;gDACX,EAAE;gDACF,WAAW,OAAO,cAAc,GAAG,UAAU;;;;;;;;;;;;oCAG9C,OAAO,cAAc,kBACrB,8OAAC;wCAAE,WAAU;kDAAS,OAAO,cAAc,CAAC,OAAO;;;;;;;;;;;;0CAGrD,8OAAC;gCAAI,WAAU;;kDACd,8OAAC;wCAAM,SAAQ;;4CAAO;0DAErB,8OAAC;gDACA,MAAK;gDACJ,GAAG,SAAS,QAAQ;oDAAE,UAAU;gDAAmB,EAAE;gDACtD,WAAW,OAAO,IAAI,GAAG,UAAU;;;;;;;;;;;;oCAGpC,OAAO,IAAI,kBAAI,8OAAC;wCAAE,WAAU;kDAAS,OAAO,IAAI,CAAC,OAAO;;;;;;;;;;;;;;;;;;kCAG3D,8OAAC;kCAAG;;;;;;;;;;;;YAEJ,8BACA,8OAAC,oLAAA,CAAA,WAAQ;gBAAC,QAAQ;gBAAe,SAAS;0BACzC,cAAA,8OAAC,uIAAA,CAAA,UAAa;oBAAC,0BAA0B;;;;;;;;;;;;;;;;;AAK9C;uCAEe","debugId":null}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///Users/phil/Dev/philplaysbass/components/payment/Checkout.tsx"],"sourcesContent":["\"use client\";\nimport React, { useState } from \"react\";\nimport useCookies from \"../hooks/useCookies\";\nimport PaymentForm from \"./PaymentForm\";\nimport \"./Checkout.css\";\nimport { useApiCall } from \"../services/membership\";\nimport { createUser, createMembership } from \"../services/membership\";\n\nconst Checkout = () => {\n\tconst [homeClub, setHomeClub] = useState(undefined);\n\tconst [membership, setMembership] = useState(\"\");\n\tconst [paymentDetails, setPaymentDetails] = useState(null);\n\tconst [completed, setCompleted] = useState([]);\n\n\tconst { setCookie, getCookie, deleteCookie } = useCookies();\n\tconst {\n\t\texecute: exeUser,\n\t\tisLoading: isUserLoading,\n\t\tuserError,\n\t} = useApiCall(createUser);\n\n\tconst {\n\t\texecute: exeMembership,\n\t\tisLoading: isMembershipLoading,\n\t\tmembershipError,\n\t} = useApiCall(createMembership);\n\n\tconst checkoutSequence = [\n\t\t\"homeclub\",\n\t\t\"membership\",\n\t\t\"addons\",\n\t\t\"details\",\n\t\t\"payment\",\n\t];\n\n\tconst handleSubmitRegistration = async (data) => {\n\t\tconst userData = {\n\t\t\temail: data.email,\n\t\t\tpassword: data.password,\n\t\t};\n\t\tconst membershipData = {\n\t\t\ttype: membership,\n\t\t\tstartDate: new Date(),\n\t\t\tactive: true,\n\t\t\towner: user._id,\n\t\t\t// TODO: calculate correct date\n\t\t\tendDate: new Date(),\n\t\t\tlocation: homeClub,\n\t\t};\n\t\ttry {\n\t\t\tconst user = await exeUser(userData);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new Error(\"User creation failed\");\n\t\t\t}\n\t\t\tconst membership = await exeMembership(membershipData);\n\n\t\t\tif (!membership) {\n\t\t\t\tthrow new Error(\"Membership creation failed\");\n\t\t\t}\n\n\t\t\tconsole.log(user, membership);\n\t\t\tif (user && membership) {\n\t\t\t\tnavigate(\"/\");\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"checkout_ctn\">\n\t\t\t<h1>Payment</h1>\n\t\t\t<PaymentForm\n\t\t\t\tonSubmit={handleSubmitRegistration}\n\t\t\t\tpaymentDetails={paymentDetails}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default Checkout;\n"],"names":[],"mappings":";;;;AACA;;;;;;AAEA;;;;;;AAHA;;;;;;;;AAQA,MAAM,WAAW;IAChB,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrD,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,EAAE;IAE7C,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG;IAC/C,MAAM,EACL,SAAS,OAAO,EAChB,WAAW,aAAa,EACxB,SAAS,EACT,GAAG,WAAW;IAEf,MAAM,EACL,SAAS,aAAa,EACtB,WAAW,mBAAmB,EAC9B,eAAe,EACf,GAAG,WAAW;IAEf,MAAM,mBAAmB;QACxB;QACA;QACA;QACA;QACA;KACA;IAED,MAAM,2BAA2B,OAAO;QACvC,MAAM,WAAW;YAChB,OAAO,KAAK,KAAK;YACjB,UAAU,KAAK,QAAQ;QACxB;QACA,MAAM,iBAAiB;YACtB,MAAM;YACN,WAAW,IAAI;YACf,QAAQ;YACR,OAAO,KAAK,GAAG;YACf,+BAA+B;YAC/B,SAAS,IAAI;YACb,UAAU;QACX;QACA,IAAI;YACH,MAAM,QAAO,MAAM,QAAQ;YAE3B,IAAI,CAAC,OAAM;gBACV,MAAM,IAAI,MAAM;YACjB;YACA,MAAM,aAAa,MAAM,cAAc;YAEvC,IAAI,CAAC,YAAY;gBAChB,MAAM,IAAI,MAAM;YACjB;YAEA,QAAQ,GAAG,CAAC,OAAM;YAClB,IAAI,SAAQ,YAAY;gBACvB,SAAS;YACV;QACD,EAAE,OAAO,KAAK;YACb,QAAQ,KAAK,CAAC;QACf;IACD;IAEA,qBACC,8OAAC;QAAI,WAAU;;0BACd,8OAAC;0BAAG;;;;;;0BACJ,8OAAC,qIAAA,CAAA,UAAW;gBACX,UAAU;gBACV,gBAAgB;;;;;;;;;;;;AAIpB;uCAEe","debugId":null}}]
}